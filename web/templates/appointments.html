{% extends "base.html" %}

{% block content %}
<div class="notion-page-header">
    <h1>
        <span class="icon">üìÖ</span>
        –ó–∞–ø–∏—Å–∏
    </h1>
    <div class="notion-page-description">
        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="notion-block filters-block">
    <div class="notion-block-body">
        <form method="get" class="filters-form">
            <div class="filter-group">
                <label class="notion-label">–î–∞—Ç–∞</label>
                <input type="date" name="date" value="{{ selected_date }}" class="notion-input">
            </div>
            <div class="filter-group">
                <label class="notion-label">–°—Ç–∞—Ç—É—Å</label>
                <select name="status" class="notion-input">
                    <option value="">–í—Å–µ</option>
                    <option value="pending" {% if status == 'pending' %}selected{% endif %}>–û–∂–∏–¥–∞–µ—Ç</option>
                    <option value="confirmed" {% if status == 'confirmed' %}selected{% endif %}>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</option>
                    <option value="completed" {% if status == 'completed' %}selected{% endif %}>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
                    <option value="cancelled" {% if status == 'cancelled' %}selected{% endif %}>–û—Ç–º–µ–Ω–µ–Ω–æ</option>
                </select>
            </div>
            <div class="filter-actions">
                <button type="submit" class="notion-button notion-button-primary">
                    <i data-feather="filter"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                </button>
                <a href="{{ url_for('appointments.appointments_list') }}" class="notion-button">
                    <i data-feather="x"></i> –°–±—Ä–æ—Å–∏—Ç—å
                </a>
            </div>
        </form>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π -->
<div class="notion-block">
    <div class="notion-block-header">
        <h2>–°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π</h2>
        {# –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
        <a href="{{ url_for('appointments.new_appointment') }}" class="notion-button notion-button-primary">
            <i data-feather="plus"></i> –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å
        </a>
        #}
    </div>
    <div class="notion-block-body">
        {% if appointments %}
        <table class="notion-table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–£—Å–ª—É–≥–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for apt in appointments %}
                <tr>
                    <td>{{ apt.date }}</td>
                    <td>{{ apt.time }}</td>
                    <td>{{ apt.client_name }}</td>
                    <td>{{ apt.service }}</td>
                    <td>
                        {% if apt.status == 'confirmed' %}
                            <span class="notion-badge notion-badge-success">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</span>
                        {% elif apt.status == 'pending' %}
                            <span class="notion-badge notion-badge-warning">–û–∂–∏–¥–∞–µ—Ç</span>
                        {% elif apt.status == 'completed' %}
                            <span class="notion-badge" style="background: #e3f2fd; color: #1976d2;">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                        {% elif apt.status == 'cancelled' %}
                            <span class="notion-badge notion-badge-danger">–û—Ç–º–µ–Ω–µ–Ω–æ</span>
                        {% endif %}
                    </td>
                    <td class="actions">
                        <a href="{{ url_for('appointments.appointment_detail', appointment_id=apt.id) }}" class="notion-button">
                            <i data-feather="eye"></i>
                        </a>
                        <button class="notion-button" onclick="editAppointment({{ apt.id }})">
                            <i data-feather="edit-2"></i>
                        </button>
                        <button class="notion-button" onclick="cancelAppointment({{ apt.id }})">
                            <i data-feather="x-circle"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if total_pages > 1 %}
        <div class="pagination">
            {% for p in range(1, total_pages + 1) %}
                <a href="{{ url_for('appointments.appointments_list', page=p, date=selected_date, status=status) }}" 
                   class="notion-button {% if p == page %}notion-button-primary{% endif %}">
                    {{ p }}
                </a>
            {% endfor %}
        </div>
        {% endif %}
        {% else %}
        <p class="empty-state">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function cancelAppointment(id) {
    if (confirm('–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
        fetch(`/appointments/${id}/cancel`, { method: 'POST' })
            .then(r => r.json())
            .then(data => {
                if (data.success) location.reload();
                else alert('–û—à–∏–±–∫–∞');
            });
    }
}
</script>
{% endblock %}